import{r as l,d as j,j as t,a as p}from"./index-_ibJpO5e.js";const d="https://backend-three-sigma-81.vercel.app/api",v=()=>{const[m,h]=l.useState([]),[f,u]=l.useState(!0),g=j(),x=async()=>{u(!0);try{const a=(()=>{const s=localStorage.getItem("gm_auth");if(s)try{const c=JSON.parse(s);if(c&&c.token)return{Authorization:`Bearer ${c.token}`}}catch{}const i=localStorage.getItem("admin_dashboard_token");return i?{Authorization:`Bearer ${i}`}:{}})();console.log("[NotificationsPage] Fetching from:",`${d}/notifications/me`,"with auth:",!!a.Authorization);const o=await fetch(`${d}/notifications/me`,{headers:a});if(console.log("[NotificationsPage] Response status:",o.status),!o.ok){const s=await o.text();throw console.error("[NotificationsPage] Error response:",s),new Error(`HTTP ${o.status}: ${s}`)}const r=await o.json();console.log("[NotificationsPage] Fetched data:",r);const n=Array.isArray(r)?r:r.data||r.notifications||[];console.log("[NotificationsPage] Parsed list:",n),h(n)}catch(e){console.error("[NotificationsPage] Load notifications error",e),h([])}finally{u(!1)}};l.useEffect(()=>{x()},[]);const N=async e=>{try{const o=(()=>{const n=localStorage.getItem("gm_auth");if(n)try{const i=JSON.parse(n);if(i&&i.token)return{Authorization:`Bearer ${i.token}`}}catch{}const s=localStorage.getItem("admin_dashboard_token");return s?{Authorization:`Bearer ${s}`}:{}})();(await fetch(`${d}/notifications/me/${e}/read`,{method:"POST",headers:o})).ok&&await x()}catch(a){console.error("[NotificationsPage] Mark read failed",a)}};return t.jsxs("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-accent/10 flex items-center justify-center",children:t.jsx(p,{name:"Bell",size:20,className:"text-accent"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Notifications"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"All your recent notifications"})]})]}),f?t.jsx("div",{children:"Loadingâ€¦"}):t.jsxs("div",{className:"space-y-4",children:[m.length===0&&t.jsx("div",{className:"text-muted-foreground",children:"No notifications found."}),m.map(e=>{const a=e.read===0||e.read===!1||e.read===null;return t.jsx("div",{className:`p-4 border rounded-lg ${a?"bg-accent/5":"bg-background"}`,children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:e.title||"Notice"}),t.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:e.body}),e.link&&t.jsx("div",{className:"mt-2",children:t.jsx("button",{onClick:()=>g(e.link),className:"text-sm text-accent underline",children:"Open link"})})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleString()}),a&&t.jsx("button",{onClick:()=>N(e.link_id),className:"mt-2 inline-flex items-center px-2 py-1 text-xs bg-accent text-white rounded",children:"Mark read"})]})]})},e.link_id||e.notification_id||Math.random())})]})]})};export{v as default};
