import{r as n,j as e,H as L,B as x,a as t,e as _}from"./index-_ibJpO5e.js";const j="https://backend-three-sigma-81.vercel.app/api",J=()=>{const[k,w]=n.useState([]),[A,B]=n.useState(!1),[T,u]=n.useState(!1),[d,C]=n.useState(null),[c,g]=n.useState({title:"",slug:"",excerpt:"",content:"",image_url:"",published:!0}),[S,o]=n.useState(""),[z,p]=n.useState(""),[N,v]=n.useState(!1),[E,f]=n.useState(""),y=async()=>{B(!0);try{const s=localStorage.getItem("gm_auth"),r=s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{},l=await(await fetch(`${j}/admin/blogs`,{headers:r})).json();w(l.data||[])}catch{o("Failed to fetch blogs")}B(!1)};n.useEffect(()=>{y()},[]);const I=()=>{C(null),g({title:"",slug:"",excerpt:"",content:"",image_url:"",published:!0}),f(""),o(""),p(""),u(!0)},F=s=>{C(s),g({title:s.title,slug:s.slug,excerpt:s.excerpt||"",content:s.content||"",image_url:s.image_url||"",published:s.published===1||s.published===!0}),f(s.image_url||""),o(""),p(""),u(!0)},h=s=>{const{name:r,value:a,type:l,checked:m}=s.target;g(i=>({...i,[r]:l==="checkbox"?m:a}))},P=async s=>{var a;const r=(a=s.target.files)==null?void 0:a[0];if(r){if(!r.type.startsWith("image/")){o("Please select a valid image file");return}v(!0),o("");try{const l=new FileReader;l.onload=async m=>{var b;const i=(b=m.target)==null?void 0:b.result;f(i),g(U=>({...U,image_url:i})),v(!1)},l.readAsDataURL(r)}catch{o("Failed to process image"),v(!1)}}},D=async()=>{if(o(""),!c.title||!c.slug){o("Title and Slug are required");return}const s=localStorage.getItem("gm_auth"),r={"Content-Type":"application/json",...s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{}};try{const a={...c,published:c.published?1:0};console.log("[Blogs Admin] Saving blog with payload:",a);const l=d?`${j}/admin/blogs/${d.id}`:`${j}/admin/blogs`,i=await fetch(l,{method:d?"PUT":"POST",headers:r,body:JSON.stringify(a)});if(!i.ok)throw new Error("Failed to save blog");const b=await i.json();console.log("[Blogs Admin] Save result:",b),p(d?"Blog updated successfully":"Blog created successfully"),setTimeout(()=>{u(!1),y()},1e3)}catch(a){o(a.message||"Failed to save blog")}},$=async s=>{if(!confirm("Delete this blog?"))return;const r=localStorage.getItem("gm_auth"),a={...r?{Authorization:`Bearer ${JSON.parse(r).token}`}:{}};try{if(console.log("[Blogs Admin] Deleting blog:",s),!(await fetch(`${j}/admin/blogs/${s}`,{method:"DELETE",headers:a})).ok)throw new Error("Failed to delete blog");w(m=>m.filter(i=>i.id!==s)),p("Blog deleted successfully"),console.log("[Blogs Admin] Blog deleted successfully"),setTimeout(()=>{y()},500)}catch(l){console.error("[Blogs Admin] Delete error:",l),o("Failed to delete blog")}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-5 lg:px-8 py-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Manage Blogs"}),e.jsx("p",{className:"text-muted-foreground",children:"Create, edit, and manage your blog posts"})]}),e.jsxs(x,{onClick:I,className:"bg-gradient-to-r from-pink-500 to-rose-500",children:[e.jsx(t,{name:"Plus",size:18,className:"mr-2"}),"Create Blog"]})]}),A?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(t,{name:"Loader2",size:32,className:"animate-spin text-accent"})}):k.length===0?e.jsxs("div",{className:"text-center py-12 bg-card border border-border rounded-lg",children:[e.jsx(t,{name:"FileText",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No blogs yet. Create your first blog post!"}),e.jsx(x,{onClick:I,variant:"outline",children:"Create Blog"})]}):e.jsx("div",{className:"grid gap-4",children:k.map(s=>e.jsx("div",{className:"bg-card border border-border rounded-xl overflow-hidden hover:border-accent/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-6 p-6",children:[s.image_url&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:s.image_url,alt:s.title,className:"w-32 h-32 object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.title}),s.published?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"Published"}):e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:"Draft"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.jsx("code",{className:"bg-muted px-2 py-1 rounded",children:s.slug})}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.excerpt})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>F(s),className:"flex items-center gap-2",children:[e.jsx(t,{name:"Edit",size:16}),"Edit"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>$(s.id),className:"flex items-center gap-2 text-destructive hover:bg-destructive/10",children:[e.jsx(t,{name:"Trash2",size:16}),"Delete"]})]})]})},s.id))})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border/50 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-accent/10 to-pink-500/10 border-b border-border/50 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:d?"Edit Blog Post":"Create New Blog Post"}),e.jsx("button",{onClick:()=>u(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(t,{name:"X",size:24})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[S&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive px-4 py-3 rounded-lg flex items-start gap-3",children:[e.jsx(t,{name:"AlertTriangle",size:18,className:"flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:S})]}),z&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-start gap-3",children:[e.jsx(t,{name:"CheckCircle2",size:18,className:"flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:z})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Title *"}),e.jsx(_,{type:"text",name:"title",value:c.title,onChange:h,placeholder:"Enter blog title",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Slug (URL-friendly) *"}),e.jsx(_,{type:"text",name:"slug",value:c.slug,onChange:h,placeholder:"enter-blog-slug",className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"e.g., simple-skincare-routine"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Excerpt"}),e.jsx("textarea",{name:"excerpt",value:c.excerpt,onChange:h,placeholder:"Brief summary of the blog post",rows:"3",className:"w-full px-4 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:border-accent resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Blog Image"}),e.jsx("div",{className:"border-2 border-dashed border-border rounded-lg p-4 transition-colors hover:border-accent/50",children:E?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:E,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"bg-accent/10 hover:bg-accent/20 text-accent py-2 px-3 rounded-lg text-center text-sm font-medium transition-colors",children:[e.jsx(t,{name:"Upload",size:16,className:"inline mr-1"}),"Change Image"]}),e.jsx("input",{type:"file",accept:"image/*",onChange:P,disabled:N,className:"hidden"})]}),e.jsxs("button",{type:"button",onClick:()=>{f(""),g(s=>({...s,image_url:""}))},className:"flex-1 bg-destructive/10 hover:bg-destructive/20 text-destructive py-2 px-3 rounded-lg text-center text-sm font-medium transition-colors",children:[e.jsx(t,{name:"Trash2",size:16,className:"inline mr-1"}),"Remove"]})]})]}):e.jsxs("label",{className:"cursor-pointer block",children:[e.jsxs("div",{className:"text-center py-6",children:[e.jsx(t,{name:"Image",size:32,className:"mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Click to upload image"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, GIF up to 10MB"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:P,disabled:N,className:"hidden"})]})}),N&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-2",children:[e.jsx(t,{name:"Loader2",size:16,className:"animate-spin"}),"Processing image..."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Content"}),e.jsx("textarea",{name:"content",value:c.content,onChange:h,placeholder:"Write your blog post content here...",rows:"10",className:"w-full px-4 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:border-accent resize-none font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("input",{type:"checkbox",name:"published",checked:c.published,onChange:h,className:"w-5 h-5 rounded border-border cursor-pointer"}),e.jsx("label",{className:"text-sm font-medium text-foreground cursor-pointer flex-1",children:"Publish this blog post"})]})]}),e.jsxs("div",{className:"border-t border-border/50 px-6 py-4 flex items-center justify-end gap-3 bg-muted/10",children:[e.jsx(x,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(x,{onClick:D,className:"bg-gradient-to-r from-pink-500 to-rose-500",children:[e.jsx(t,{name:"Save",size:18,className:"mr-2"}),d?"Update Blog":"Create Blog"]})]})]})})]})};export{J as default};
