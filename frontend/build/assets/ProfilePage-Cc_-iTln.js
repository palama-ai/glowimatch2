import{c as $,u as U,d as G,r as c,j as e,H as A,a as R,B as d,e as T}from"./index-_ibJpO5e.js";const K=()=>{var C,E,L;const{user:u,userProfile:a,subscription:J,signOut:B,updateProfile:O,loading:h}=$(),{refreshProfile:z}=$(),{t:s}=U(),b=G(),[p,j]=c.useState(!1),[l,N]=c.useState({full_name:"",email:""}),[x,v]=c.useState(!1),[i,n]=c.useState(""),[g,y]=c.useState(!1),[k,w]=c.useState(null);c.useEffect(()=>{!h&&!u&&b("/login")},[u,h,b]),c.useEffect(()=>{a&&(N({full_name:(a==null?void 0:a.full_name)||"",email:(a==null?void 0:a.email)||""}),console.log("[Profile] User profile loaded:",{hasReferralCode:!!(a!=null&&a.referral_code),code:a==null?void 0:a.referral_code,stats:a==null?void 0:a.referralStats,allData:a}))},[a]);const q=async()=>{await B(),b("/")},F=async t=>{t==null||t.preventDefault(),v(!0),n("");const{error:r}=await O(l);r?n(r==null?void 0:r.message):(n(s("profile_updated")),j(!1)),v(!1)},S=t=>{var r,o;N({...l,[(r=t==null?void 0:t.target)==null?void 0:r.name]:(o=t==null?void 0:t.target)==null?void 0:o.value})};return h?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(R,{name:"Loader2",size:48,className:"animate-spin text-accent"})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{}),e.jsx(A,{}),e.jsx("main",{className:"max-w-4xl mx-auto px-5 lg:px-8 py-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-card rounded-xl border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-card-foreground",children:s("profile_settings")}),e.jsx(d,{variant:"outline",onClick:q,iconName:"LogOut",children:s("sign_out")})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(T,{id:"full_name",name:"full_name",type:"text",label:s("full_name_label"),value:l==null?void 0:l.full_name,onChange:S,disabled:!p,required:!0}),e.jsx(T,{id:"email",name:"email",type:"email",label:s("email_address_label"),value:l==null?void 0:l.email,onChange:S,disabled:!p,required:!0})]}),i&&e.jsx("div",{className:`px-4 py-3 rounded-lg ${i!=null&&i.includes("successfully")?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:i}),e.jsx("div",{className:"flex items-center space-x-4",children:p?e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"submit",disabled:x,iconName:x?"Loader2":"Save",iconClassName:x?"animate-spin":"",children:s(x?"saving":"save_changes")}),e.jsx(d,{type:"button",variant:"outline",onClick:()=>{j(!1),N({full_name:(a==null?void 0:a.full_name)||"",email:(a==null?void 0:a.email)||""})},children:s("cancel")})]}):e.jsx(d,{type:"button",onClick:()=>j(!0),iconName:"Edit",children:s("edit_profile")})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent/5 to-secondary/5 border border-accent/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(R,{name:"Share2",size:24,className:"text-accent"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:s("referral_program")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-background/60 border border-accent/20 p-5 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium mb-2",children:s("your_referral_code")}),e.jsx("div",{className:"bg-card border border-border rounded-lg p-4 mb-3",children:e.jsx("code",{className:"text-lg font-mono font-bold text-accent",children:(a==null?void 0:a.referral_code)||"â€”"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"w-full",onClick:()=>{var r;if(!(a!=null&&a.referral_code)){alert("Referral code not available. Please generate one.");return}const t=`${window.location.origin}/?ref=${a==null?void 0:a.referral_code}`;(r=navigator.clipboard)==null||r.writeText(t),n(s("referral_copied")),setTimeout(()=>n(""),3e3)},iconName:"Copy",children:s("copy_referral_link")}),e.jsx(d,{variant:"outline",className:"w-full",disabled:g,onClick:async()=>{var t;if(u){y(!0),w(null);try{const r=localStorage.getItem("gm_auth"),o=r?JSON.parse(r).token:null,I=await fetch("https://backend-three-sigma-81.vercel.app/api/referrals/create",{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}}}),m=await I.json().catch(()=>null)||{};if(I.ok&&(m.data||m)){const f=m.data||m,_=f.referral_link||f.link||(f.referral_code?`${window.location.origin}/?ref=${f.referral_code}`:null);w(_);try{await z()}catch(H){console.debug("refreshProfile failed",H)}_&&((t=navigator.clipboard)==null||t.writeText(_),n(s("referral_generated")),setTimeout(()=>n(""),3e3))}else n(s("referral_failed")),console.warn("create referral failed",m)}catch(r){console.error("Error creating referral code",r),n(s("referral_failed"))}finally{y(!1)}}},iconName:g?"Loader2":"RefreshCw",iconClassName:g?"animate-spin":"",children:s(g?"generating":"generate_code")})]})]}),e.jsxs("div",{className:"bg-background/60 border border-accent/20 p-5 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium mb-3",children:s("referral_stats")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s("referral_total"),":"]}),e.jsx("span",{className:"text-2xl font-bold text-accent",children:((C=a==null?void 0:a.referralStats)==null?void 0:C.totalReferrals)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s("referral_recent"),":"]}),e.jsxs("span",{className:"text-lg font-semibold text-foreground",children:[((E=a==null?void 0:a.referralStats)==null?void 0:E.recentCount)??0," / 10"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s("referral_slots"),":"]}),e.jsx("span",{className:"text-lg font-semibold text-green-600",children:((L=a==null?void 0:a.referralStats)==null?void 0:L.remainingSlots)??10})]}),e.jsx("div",{className:"mt-4 p-3 bg-accent/5 border border-accent/10 rounded-lg",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:s("referral_description")})})]})]})]}),k&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-800 font-mono break-all",children:k})})]})]})})]})};export{K as default};
