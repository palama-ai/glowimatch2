import{d as H,c as L,r as h,j as e,H as k,a as o,B as f,q as y}from"./index-_ibJpO5e.js";const E=()=>{var j,N,p;const d=H(),{user:u}=L(),[i,g]=h.useState([]),[w,A]=h.useState(!0),[m,x]=h.useState(null);h.useEffect(()=>{(async()=>{if(!u){d("/login");return}try{const{data:t,error:r}=await y.getQuizHistory(u.id);if(r)throw r;g(t||[])}catch(t){console.error("Error loading quiz history:",t)}finally{A(!1)}})()},[u,d]);const v=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=s=>({oily:"text-blue-600",dry:"text-orange-600",sensitive:"text-red-600",combination:"text-purple-600",normal:"text-green-600"})[s==null?void 0:s.toLowerCase()]||"text-foreground",_=s=>{if(!s)return{sensitivity:null,routine:null,concerns_count:null,analysis:null};const t={1:20,2:40,3:60,4:80,5:100},r=s.sensitivity_level?t[s.sensitivity_level]||s.sensitivity_level*20:null,c={minimal:25,basic:50,comprehensive:75,extensive:100},a=s.routine_complexity?c[s.routine_complexity]||50:null,n=s.concerns||s.skinConcerns||[],l=Array.isArray(n)?n.length:null,z=s.confidence||s.confidenceScore||s.overall_confidence,D=z!=null;return{sensitivity:r,routine:a,concerns_count:l,analysis:D?z:null}},b=s=>s&&(s.skin_type||s.skinType||s.type)||"Unknown",q=s=>s?s.concerns||s.skinConcerns||[]:[],C=async s=>{if(confirm("Are you sure you want to delete this quiz result?")){x(s);try{const{success:t,error:r}=await y.deleteQuizAttempt(s);t?g(c=>c.filter(a=>a.id!==s)):alert("Failed to delete quiz result")}catch(t){console.error("Error deleting attempt:",t),alert("Failed to delete quiz result")}finally{x(null)}}},Q=async()=>{if(confirm("Are you sure you want to delete ALL quiz history? This cannot be undone.")){x("all");try{const{success:s,error:t}=await y.deleteAllQuizHistory(u.id);s?g([]):alert("Failed to delete quiz history")}catch(s){console.error("Error deleting all history:",s),alert("Failed to delete quiz history")}finally{x(null)}}};return w?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(k,{}),e.jsx("main",{className:"max-w-4xl mx-auto px-5 lg:px-8 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(o,{name:"Loader2",size:32,className:"animate-spin text-accent"})})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(k,{}),e.jsxs("main",{className:"max-w-5xl mx-auto px-5 lg:px-8 py-8 pb-12",children:[e.jsxs("div",{className:"flex items-start justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx(o,{name:"History",size:40,className:"mb-4 text-accent"}),e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Quiz History"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Track your skin's progress and see how your results have changed over time."})]}),i.length>0&&e.jsxs("button",{onClick:Q,disabled:m==="all",className:"flex items-center gap-2 px-4 py-2 text-destructive border border-destructive/30 rounded-lg hover:bg-destructive/10 transition-colors disabled:opacity-50",children:[e.jsx(o,{name:"Trash2",size:16}),m==="all"?"Deleting...":"Delete All"]})]}),i.length===0?e.jsxs("div",{className:"text-center py-16 bg-accent/5 border border-accent/10 rounded-xl",children:[e.jsx(o,{name:"BookOpen",size:64,className:"mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-2xl font-semibold text-foreground mb-2",children:"No Quiz Attempts Yet"}),e.jsx("p",{className:"text-muted-foreground mb-2 max-w-md mx-auto",children:"Start your first skin quiz to begin tracking your skin health journey."}),e.jsx(f,{onClick:()=>d("/interactive-skin-quiz"),iconName:"ArrowRight",iconPosition:"right",className:"mt-4",children:"Take Your First Quiz"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Quizzes"}),e.jsx("div",{className:"text-3xl font-bold text-accent mt-1",children:i.length})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Latest Result"}),e.jsxs("div",{className:"text-lg font-semibold text-foreground mt-1 capitalize",children:[b((j=i[0])==null?void 0:j.results)," Skin"]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Last Taken"}),e.jsx("div",{className:"text-sm font-medium text-foreground mt-1",children:v(((N=i[0])==null?void 0:N.attempt_date)||((p=i[0])==null?void 0:p.created_at))})]})]}),i.map((s,t)=>{const r=_(s.results),c=b(s.results),a=q(s.results);return e.jsx("div",{className:"bg-card border border-border rounded-lg hover:border-accent/50 transition-colors overflow-hidden",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-accent/10 text-accent font-semibold text-sm",children:["#",i.length-t]}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:v(s.attempt_date||s.created_at)}),s.has_image_analysis&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(o,{name:"Image",size:12,className:"mr-1"}),"With Image"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:`text-2xl font-bold capitalize ${S(c)}`,children:[c," Skin"]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.slice(0,3).map((n,l)=>e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-muted text-muted-foreground border border-border",children:String(n).replace(/_/g," ")},l)),a.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground pt-1",children:["+",a.length-3," more"]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 md:w-64",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[{label:"Sensitivity",value:r.sensitivity,suffix:"%"},{label:"Routine",value:r.routine,suffix:"%"},{label:"Concerns",value:r.concerns_count,suffix:""},{label:"AI Analysis",value:r.analysis,suffix:"%"}].map((n,l)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-accent",children:n.value!=null?`${Math.round(n.value)}${n.suffix}`:"â€”"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n.label})]},l))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{const n={...s.quiz_data,attemptId:s.id};localStorage.setItem("glowmatch-quiz-data",JSON.stringify(n));const l={...s.results,savedAnalysis:s.analysis||null};localStorage.setItem("glowmatch-analysis",JSON.stringify(l)),d("/results-dashboard")},iconName:"Eye",className:"flex-1",children:"View Results"}),e.jsx("button",{onClick:()=>C(s.id),disabled:m===s.id,className:"p-2 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded-lg transition-colors disabled:opacity-50",children:m===s.id?e.jsx(o,{name:"Loader2",size:16,className:"animate-spin"}):e.jsx(o,{name:"Trash2",size:16})})]})]})]})})},s.id)})]}),i.length>0&&e.jsxs("div",{className:"mt-12 bg-gradient-to-r from-accent/10 to-secondary/10 border border-accent/20 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-3",children:"Ready for a fresh analysis? Your skin changes over time."}),e.jsx(f,{onClick:()=>d("/interactive-skin-quiz"),iconName:"RotateCcw",iconPosition:"left",className:"mt-4",children:"Take Another Quiz"})]})]})]})};export{E as default};
