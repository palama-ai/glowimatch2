import{r as m,j as t,H as j}from"./index-_ibJpO5e.js";const i="https://backend-three-sigma-81.vercel.app/api",$=()=>{const[p,u]=m.useState([]),[f,g]=m.useState(!1),[h,l]=m.useState(null),c=async()=>{g(!0),l(null);const e=localStorage.getItem("gm_auth"),r=e?{Authorization:`Bearer ${JSON.parse(e).token}`}:{};try{const s=await fetch(`${i}/admin/users`,{headers:r}),n=await s.text();let a=null;try{a=JSON.parse(n)}catch{}if(s.ok)u((a==null?void 0:a.data)||[]),(!a||!a.data)&&l("No users returned from server");else{console.error("Failed to fetch admin users",s.status,n);try{const d=await fetch(`${i}/admin/debug/users`);if(d.ok){const o=await d.json();u(o.data||[]),l("Using debug endpoint (no auth)");return}}catch{}l((a==null?void 0:a.error)||`Request failed: ${s.status}`),u([])}}catch(s){console.error("fetchUsers error",s),l(s.message||"Network error"),u([])}finally{g(!1)}};m.useEffect(()=>{c()},[]);const b=async(e,r)=>{const s=localStorage.getItem("gm_auth"),n={"Content-Type":"application/json",...s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{}};await fetch(`${i}/admin/users/${e}`,{method:"PATCH",headers:n,body:JSON.stringify({disabled:r})}),c()},y=async e=>{const r=prompt("Enter deactivation message to show to the user (leave empty to clear)");if(r===null)return;const s=localStorage.getItem("gm_auth"),n={"Content-Type":"application/json",...s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{}};await fetch(`${i}/admin/users/${e}`,{method:"PATCH",headers:n,body:JSON.stringify({status_message:r})}),c()},N=async e=>{if(!confirm("Are you sure you want to delete this user? This is a soft-delete and can be reversed by an admin."))return;const s=localStorage.getItem("gm_auth"),n={"Content-Type":"application/json",...s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{}};try{const a=await fetch(`${i}/admin/users/${e}`,{method:"DELETE",headers:n}),d=await a.text().catch(()=>null);let o=null;try{o=d?JSON.parse(d):null}catch{}if(a.ok)alert("User deleted");else{console.error("Failed to delete user",a.status,d,o);const x=(o==null?void 0:o.error)||(o==null?void 0:o.details)||d||`Request failed: ${a.status}`;alert("Failed to delete user: "+x)}}catch(a){console.error("deleteUser error",a),alert("Failed to delete user")}c()},S=async e=>{const r=prompt("Enter plan id (e.g. basic, pro)");if(!r)return;const s=localStorage.getItem("gm_auth"),n={"Content-Type":"application/json",...s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{}};await fetch(`${i}/admin/users/${e}/subscription`,{method:"POST",headers:n,body:JSON.stringify({planId:r,status:"active"})}),c()};return t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsx(j,{}),t.jsxs("main",{className:"max-w-6xl mx-auto px-5 lg:px-8 py-12",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Manage Users"}),f?t.jsx("div",{children:"Loading..."}):t.jsxs("div",{className:"space-y-4",children:[h&&t.jsxs("div",{className:"text-sm text-red-600",children:["Error: ",h]}),p.length===0&&!h&&t.jsx("div",{className:"text-sm text-muted-foreground",children:"No users found."}),p.map(e=>{var r;return t.jsxs("div",{className:"bg-card border border-border rounded-lg p-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.full_name||e.email}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.email}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Role: ",e.role," | Subscription: ",((r=e.subscription)==null?void 0:r.plan_id)||"none"]})]}),t.jsxs("div",{className:"space-x-2",children:[e.deleted?t.jsx("span",{className:"px-3 py-1 rounded bg-gray-100 text-sm text-muted-foreground",children:"Deleted"}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>b(e.id,!e.disabled),className:`px-3 py-1 rounded ${e.disabled?"bg-green-100":"bg-red-100"}`,children:e.disabled?"Enable":"Disable"}),t.jsx("button",{onClick:()=>y(e.id),className:"px-3 py-1 rounded bg-yellow-100",children:"Set Message"}),t.jsx("button",{onClick:()=>N(e.id),className:"px-3 py-1 rounded bg-red-100",children:"Delete"})]}),t.jsx("button",{onClick:()=>S(e.id),className:"px-3 py-1 rounded bg-accent/10",children:"Set Plan"})]})]},e.id)})]})]})]})};export{$ as default};
