import{r,j as e,a as o,e as k,B as A}from"./index-_ibJpO5e.js";import{A as z}from"./AdminLayout-DEpWlMYQ.js";const w="https://backend-three-sigma-81.vercel.app/api",B=()=>{const[l,u]=r.useState([]),[h,f]=r.useState(!1),[i,g]=r.useState(""),[n,p]=r.useState(""),[d,b]=r.useState(!1),[N,x]=r.useState(""),[j,m]=r.useState("");function y(){const t=localStorage.getItem("gm_auth");if(t)try{const a=JSON.parse(t);if(a&&a.token)return{Authorization:`Bearer ${a.token}`}}catch{}const s=localStorage.getItem("admin_dashboard_token");return s?{Authorization:`Bearer ${s}`}:{}}const v=async()=>{f(!0);try{const t=y();console.log("[Notifications] Fetching notifications with headers:",!!t.Authorization);const s=await fetch(`${w}/notifications/admin`,{headers:t});if(console.log("[Notifications] Response status:",s.status),!s.ok){const c=await s.text();throw console.error("[Notifications] Error response:",c),new Error(`HTTP ${s.status}: ${c}`)}const a=await s.json();console.log("[Notifications] Fetched data:",a),u(a.data||[])}catch(t){console.error("[Notifications] Failed to load notifications",t),m("Failed to load notifications"),u([])}finally{f(!1)}};r.useEffect(()=>{v()},[]);const S=async()=>{if(m(""),x(""),!i.trim()||!n.trim()){m("Title and message are required");return}b(!0);try{const t={"Content-Type":"application/json",...y()};console.log("[Notifications] Sending notification:",{title:i,body:n});const s=await fetch(`${w}/notifications/admin`,{method:"POST",headers:t,body:JSON.stringify({title:i,body:n,target:"all"})});if(!s.ok){const c=await s.text().catch(()=>"");throw console.error("[Notifications] Send error:",c),new Error(c||"Failed to send notification")}const a=await s.json();console.log("[Notifications] Send response:",a),g(""),p(""),x("âœ“ Notification sent to all users successfully!"),await v(),setTimeout(()=>x(""),3e3)}catch(t){console.error("[Notifications] sendAll error",t),m(`Failed to send notification: ${t.message}`)}finally{b(!1)}};return e.jsx(z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Send Notifications"}),e.jsx("p",{className:"text-muted-foreground",children:"Broadcast announcements and updates to all users"})]}),e.jsxs("div",{className:"bg-card border border-border/50 rounded-2xl shadow-lg p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-border/50",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent/10 flex items-center justify-center",children:e.jsx(o,{name:"Mail",size:20,className:"text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Compose Message"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send to all users"})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Notification Title *"}),e.jsx(k,{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:"e.g., New Feature Available",className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"This will appear as the headline of the notification"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Message Body *"}),e.jsx("textarea",{value:n,onChange:t=>p(t.target.value),placeholder:"Write your message here. Be clear and concise.",rows:6,className:"w-full px-4 py-3 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[n.length," characters"]})]}),j&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive px-4 py-3 rounded-lg flex items-start gap-3",children:[e.jsx(o,{name:"AlertTriangle",size:18,className:"flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:j})]}),N&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-start gap-3",children:[e.jsx(o,{name:"CheckCircle2",size:18,className:"flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:N})]}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsxs(A,{onClick:S,disabled:d||!i.trim()||!n.trim(),className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:shadow-lg hover:shadow-pink-500/40 transition-all",children:[e.jsx(o,{name:d?"Loader2":"Send",size:18,className:`mr-2 ${d?"animate-spin":""}`}),d?"Sending...":"Send to All Users"]})})]})]}),e.jsxs("div",{className:"bg-card border border-border/50 rounded-2xl shadow-lg p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-border/50",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent/10 flex items-center justify-center",children:e.jsx(o,{name:"History",size:20,className:"text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Recent Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h?"Loading...":`${l.length} notification${l.length!==1?"s":""}`})]})]}),h?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(o,{name:"Loader2",size:32,className:"animate-spin text-accent"})}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{name:"Inbox",size:48,className:"mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No notifications sent yet"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:l.map(t=>e.jsxs("div",{className:"p-4 border border-border/50 rounded-lg bg-background hover:border-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:t.body})]}),t.target_all===1&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-accent/10 text-accent text-xs font-medium rounded-full flex-shrink-0",children:"All Users"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]},t.id))})]})]})})};export{B as default};
