import{d as T,r as n,j as e,H as P,a as d,B as f}from"./index-_ibJpO5e.js";const U=()=>{const j=T(),[t,N]=n.useState(null),[b,y]=n.useState(null),[r,v]=n.useState(!1),[h,u]=n.useState(null),[w,l]=n.useState(null),[p,m]=n.useState(0);n.useEffect(()=>{u(null),l(null)},[]);const S=s=>{const o=s.target.files&&s.target.files[0];if(!o)return;if(o.size>10*1024*1024){l("File too large (max 10 MB). Please choose a smaller image.");return}const i=new FileReader;i.onload=()=>{N(i.result),y(o.name||"upload.jpg"),l(null),m(0)},i.onerror=()=>l("Failed to read file"),i.readAsDataURL(o)},A=()=>{try{const s=localStorage.getItem("gm_auth");return s?{Authorization:`Bearer ${JSON.parse(s).token}`}:{}}catch{return{}}},C=async()=>{v(!0),l(null),u(null),m(0);try{const s=t?String(t).split(",")[1]:null,i={quizData:JSON.parse(localStorage.getItem("glowmatch-quiz-data")||"{}"),images:s?[{filename:b||"upload.jpg",data:s}]:[]},z="https://backend-three-sigma-81.vercel.app/api";m(30);const x=await fetch(`${z}/analysis`,{method:"POST",headers:{"Content-Type":"application/json",...A()},body:JSON.stringify(i)});if(m(70),!x.ok){const I=await x.text().catch(()=>null);throw new Error(I||`Server error ${x.status}`)}const g=await x.json().catch(()=>null),c=g&&(g.data||g)||null,a=c&&(c.analysis||c.result||c.analysis||c)||{},k={skinType:a.skinType||a.skin_type||a.skin||a.text&&a.text.skinType||"combination",confidence:a.confidence||70,concerns:a.concerns||[],recommendations:a.recommendations||[],explanation:a.explanation||a.text||"",raw:c};u(k),m(100),localStorage.setItem("glowmatch-analysis",JSON.stringify(k)),setTimeout(()=>{j("/results-dashboard",{replace:!0})},2e3)}catch(s){l(String((s==null?void 0:s.message)||s))}finally{v(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(P,{}),e.jsxs("main",{className:"max-w-3xl mx-auto px-5 lg:px-8 py-12",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(d,{name:"Image",size:48,className:"mx-auto text-accent mb-4"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Upload Your Photo"}),e.jsx("p",{className:"text-muted-foreground max-w-xl mx-auto",children:"Take a clear, well-lit selfie of your face. Our AI will analyze your skin condition combined with your quiz responses."})]}),e.jsx("div",{className:"bg-card border border-border rounded-xl p-8 shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-accent/50 transition-colors cursor-pointer relative",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"absolute inset-0 cursor-pointer opacity-0",disabled:r}),t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{name:"CheckCircle2",size:48,className:"mx-auto text-green-600"}),e.jsx("p",{className:"font-medium text-foreground",children:"Image selected"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{name:"Upload",size:40,className:"mx-auto text-muted-foreground"}),e.jsx("p",{className:"font-medium text-foreground",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"PNG, JPG, GIF up to 10 MB"})]})]}),t&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:t,alt:"preview",className:"w-full h-64 object-cover rounded-lg border border-border"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Preview of your uploaded image"})]}),r&&p>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Analyzing your skin..."}),e.jsxs("span",{className:"font-medium",children:[Math.round(p),"%"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-accent h-full rounded-full transition-all duration-300",style:{width:`${p}%`}})})]}),w&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(d,{name:"AlertTriangle",className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Analysis Error"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:w})]})]})}),h&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(d,{name:"CheckCircle2",className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-900",children:"Analysis Complete!"}),e.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Detected: ",e.jsx("strong",{children:h.skinType})," skin (",h.confidence,"% confidence)"]}),e.jsx("p",{className:"text-xs text-green-600 mt-2",children:"Redirecting to results dashboard..."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 pt-2",children:[e.jsx(f,{onClick:C,disabled:!t||r,iconName:r?"Loader2":"Zap",className:"",children:r?"Analyzing...":"Run Analysis"}),t&&!r&&e.jsx(f,{variant:"outline",onClick:()=>{N(null),y(null),u(null),l(null)},iconName:"Trash2",children:"Clear Image"}),e.jsx(f,{variant:"ghost",onClick:()=>j("/results-dashboard"),iconName:"ArrowRight",className:"ml-auto",children:"Skip to Results"})]}),e.jsxs("div",{className:"bg-accent/5 border border-accent/10 rounded-lg p-4 mt-6",children:[e.jsxs("h3",{className:"font-medium text-foreground mb-2 flex items-center space-x-2",children:[e.jsx(d,{name:"Lightbulb",className:"h-4 w-4 text-accent"}),e.jsx("span",{children:"Tips for best results:"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Use good lighting (natural light is best)"}),e.jsx("li",{children:"• Remove makeup if possible"}),e.jsx("li",{children:"• Take a clear, frontal face photo"}),e.jsx("li",{children:"• Include your full face in the frame"})]})]})]})})]})]})};export{U as default};
